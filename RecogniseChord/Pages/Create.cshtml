@page
@model CreateModel
@{
    ViewData["Title"] = "Побудувати акорд";
}

<div class="text-center">
    <h1 class="display-4">Побудувати акорд</h1>
    <div class="innercontainer">
        <div id="rightcontainer" class="halfcontainer">
            <form method="post" asp-page-handler="Count" id="countForm">
                <p>Кількість звуків?</p>
                @foreach (var c in Model.CountOptions)
                {
                    if (Model.SelectedCount.ToString() == c)
                    {
                        @:<label class="me-2"><input type="radio" name="SelectedCount" value="@c" checked /> @c</label>
                    }
                    else
                    {
                        @:<label class="me-2"><input type="radio" name="SelectedCount" value="@c" /> @c</label>
                    }
                }
                <input type="hidden" asp-for="RootNote" />
            </form>

            <form method="post" asp-page-handler="Type" id="typeForm">
                <div class="mt-3">
                    <label>Тип:</label>
                    <select asp-for="SelectedType" class="select-chord" onchange="document.getElementById('typeForm')?.submit();">
                        <option value="">--</option>
                        @foreach (var t in Model.TypeOptions)
                        {
                            var label = t switch
                            {
                                "SECUNDA" => "секунда",
                                "TERZIA"  => "терція",
                                "QUARTA"  => "кварта",
                                "QUINTA"  => "квінта",
                                "SEKSTA"  => "секста",
                                "SEPTYMA" => "септима",
                                "OCTAVA"  => "октава",
                                "TRI"     => "тризвук",
                                "SEXT"    => "сексакторд",
                                "QSEXT"   => "квартсекстакорд",
                                "SEPT"    => "септакорд",
                                "QUINTS"  => "квінтсекстакорд",
                                "TERZQ"   => "терцквартакорд",
                                "SEC"     => "секундакорд",
                                "NONACORD" => "нонакорд",
                                "NONACORD_1i" => "нонакорд в 1 оберненні",
                                "NONACORD_2i" => "нонакорд в 2 оберненні",
                                "NONACORD_3i" => "нонакорд в 3 оберненні",
                                "NONACORD_4i" => "нонакорд в 4 оберненні",
                                _ => t
                            };

                            if (Model.SelectedType == t)
                            {
                                <option value="@t" selected>@label</option>
                            }
                            else
                            {
                                <option value="@t">@label</option>
                            }
                        }
                    </select>
                </div>
                <input type="hidden" asp-for="SelectedCount" />
                <input type="hidden" asp-for="RootNote" />
            </form>

            <form method="post" asp-page-handler="Quality" id="qualityForm">
                <div class="mt-3">
                    <label>Якість:</label>
                    @{
                        var displayCount = Model.SelectedCount;
                    }
                    <select asp-for="SelectedQuality" class="select-quality" onchange="document.getElementById('qualityForm')?.submit();">
                        <option value="">--</option>
                        @foreach (var q in Model.QualityOptions)
                        {
                            var qlabel = displayCount switch
                            {
                                2 => q switch { "MAJ" => "велика", "MIN" => "мала", _ => q },
                                3 => q switch { "MAJ" => "мажорний", "MIN" => "мінорний", "AUG" => "збільшений", "DIM" => "зменшений", _ => q },
                                4 => q switch {
                                    "MAJAUG" => "мажорний зі збільшеною квінтою",
                                    "MAJMAJ" => "мажорний (мажорна септима)",
                                    "MAJMIN" => "мажорний (мала септима)",
                                    "MINMAJ" => "мінорний (мажорна септима)",
                                    "MINMIN" => "мінорний (мала септима)",
                                    "MINDIM" => "мінорний із зменшеною квінтою",
                                    "DIMDIM" => "подвійно зменшений",
                                    "ALTQUINT" => "альтерована квінта",
                                    "ALTPRIM" => "альтерована прима",
                                    _ => q
                                },
                                5 => q switch {
                                    "HAUG" => "нона зі збільшеною ноною",
                                    "HMAJ" => "велика нона",
                                    "HDOM" => "домінантова (зі збільшеною ноною)",
                                    "NMJAUG" => "мажорна з збільшеною ноною",
                                    "NMAJ" => "мажорна нона",
                                    "NDOM" => "домінантова нона",
                                    "NMIN" => "мінорна нона",
                                    "NMDOM" => "домінантова (мала нона)",
                                    "NMMIN" => "мінорна (мала нона)",
                                    "NMHALFDIM" => "напівзменшена нона",
                                    "NMDIM" => "зменшена нона",
                                    _ => q
                                },
                                _ => q
                            };

                            if (Model.SelectedQuality == q)
                            {
                                <option value="@q" selected>@qlabel</option>
                            }
                            else
                            {
                                <option value="@q">@qlabel</option>
                            }
                        }
                    </select>
                </div>
                <div class="mt-3">
                    <label>Від ноти:</label>
                    <select asp-for="RootNote" class="select-root" onchange="document.getElementById('qualityForm')?.submit();">
                        @foreach (var r in Model.RootOptions)
                        {
                            if (Model.RootNote == r)
                            {
                                @:
                                <option value="@r" selected>@r</option>
                            }
                            else
                            {
                                @:
                                <option value="@r">@r</option>
                            }
                        }
                    </select>
                </div>
                <input type="hidden" asp-for="SelectedCount" />
                <input type="hidden" asp-for="SelectedType" />
            </form>

            <div class="mt-4">
                <button id="playBtn" type="button" class="btn btn-success" disabled>Відтворити</button>
                <audio id="chordAudio" preload="auto"></audio>
                <input type="hidden" id="generatedRel" value="@Model.GeneratedFileRelative" />
            </div>
        </div>
        <div id="leftcontainer" class="halfcontainer">
            @if (Model.CanPlay)
            {
                <p>Файл створено: <code>@Model.GeneratedFileRelative</code></p>
                <p>Акорд: @Model.SelectedType @Model.SelectedQuality (@Model.RootNote)</p>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/create.js"></script>
}
